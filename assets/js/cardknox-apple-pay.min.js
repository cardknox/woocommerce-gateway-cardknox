function setAPPayload(t){console.log(t)}function showHide(t,e){"string"==typeof t&&(t=document.getElementById(t)),t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}function getAmount(){var t=applePaysettings.total;return parseFloat(t).toFixed(2)}function getApButtonColor(t){var e=APButtonColor.black;switch(t.button_style){case"black":default:e=APButtonColor.black;break;case"white":e=APButtonColor.white;break;case"whiteOutline":e=APButtonColor.whiteOutline}return e}function getApButtonType(t){var e=APButtonType.pay;switch(t.button_type){case"pay":default:e=APButtonType.pay;break;case"buy":e=APButtonType.buy;break;case"plain":e=APButtonType.plain;break;case"order":e=APButtonType.order;break;case"donate":case"donate":e=APButtonType.donate;break;case"continue":e=APButtonType.continue;break;case"checkout":e=APButtonType.checkout}return e}jQuery(document.body).on("updated_checkout",(function(){""==applePaysettings.merchant_identifier||null==applePaysettings.merchant_identifier||0==applePaysettings.merchant_identifier.length?jQuery(".applepay-error").html("<div class='woocommerce-error' role='alert'>Please contact support. Failed to initialize Apple Pay. </div>").show():ckApplePay.enableApplePay({initFunction:"apRequest.initAP",amountField:"amount"})})),window.apRequest={buttonOptions:{buttonContainer:"ap-container",buttonColor:getApButtonColor(applePaysettings),buttonType:getApButtonType(applePaysettings)},totalAmount:null,taxAmt:null,shippingMethod:null,creditType:null,getTransactionInfo:function(){try{return{total:{type:"final",label:"Total",amount:getAmount().toString()}}}catch(t){console.error("getTransactionInfo error ",exMsg(t))}},onGetTransactionInfo:function(){try{return this.getTransactionInfo()}catch(t){console.error("onGetTransactionInfo error ",exMsg(t))}},onPaymentMethodSelected:function(t){const e=this;return new Promise(((o,n)=>{try{console.log("paymentMethod",JSON.stringify(t));o(e.getTransactionInfo(null,null,t.type))}catch(t){exMsg(t);console.error("onPaymentMethodSelected error.",exMsg(t)),n({errors:[t]})}}))},validateApplePayMerchant:function(){return new Promise(((t,e)=>{try{var o=new XMLHttpRequest;o.open("POST","https://api.cardknox.com/applepay/validate"),o.onload=function(){this.status>=200&&this.status<300?(console.log("validateApplePayMerchant",JSON.stringify(o.response)),t(o.response)):(console.error("validateApplePayMerchant",JSON.stringify(o.response),this.status),e({status:this.status,statusText:o.response}))},o.onerror=function(){console.error("validateApplePayMerchant",o.statusText,this.status),e({status:this.status,statusText:o.statusText})},o.setRequestHeader("Content-Type","application/json"),o.send()}catch(t){setTimeout((function(){console.log("getApplePaySession error: "+exMsg(t))}),100)}}))},onValidateMerchant:function(){return new Promise(((t,e)=>{try{this.validateApplePayMerchant().then((o=>{try{console.log(o),t(o)}catch(t){console.error("validateApplePayMerchant exception.",JSON.stringify(t)),e(t)}})).catch((t=>{console.error("validateApplePayMerchant error.",JSON.stringify(t)),e(t)}))}catch(t){console.error("onValidateMerchant error.",JSON.stringify(t)),e(t)}}))},authorize:function(t,e){if(console.log(t),t.token.paymentData.data){var o=btoa(JSON.stringify(t.token.paymentData));jQuery("#applePaytoken").val(o),jQuery("#place_order").trigger("click")}},onPaymentAuthorize:function(t){const e=getAmount();return new Promise(((o,n)=>{try{this.authorize(t,e.toString()).then((t=>{try{console.log(t);const e=JSON.parse(t);if(!e)throw"Invalid response: "+t;if(e.xError)throw e;o(t)}catch(t){throw t}})).catch((t=>{console.error("authorizeAPay error.",JSON.stringify(t)),apRequest.handleAPError(t),n(t)}))}catch(t){console.error("onPaymentAuthorize error.",JSON.stringify(t)),apRequest.handleAPError(t),n(t)}}))},handleAPError:function(t){t&&t.xRefNum?setAPPayload("There was a problem with your order:("+t.xRefNum+")"):setAPPayload("There was a problem with your order:"+exMsg(t))},initAP:function(){return{buttonOptions:this.buttonOptions,merchantIdentifier:applePaysettings.merchant_identifier,requiredBillingContactFields:["postalAddress","name","phone","email"],requiredShippingContactFields:["postalAddress","name","phone","email"],onGetTransactionInfo:"apRequest.onGetTransactionInfo",onGetShippingMethods:"apRequest.onGetShippingMethods",onPaymentMethodSelected:"apRequest.onPaymentMethodSelected",onValidateMerchant:"apRequest.onValidateMerchant",onPaymentAuthorize:"apRequest.onPaymentAuthorize",onPaymentComplete:"apRequest.onPaymentComplete",onAPButtonLoaded:"apRequest.apButtonLoaded",isDebug:!0}},apButtonLoaded:function(t){t&&(t.status===iStatus.success?showHide(this.buttonOptions.buttonContainer,!0):t.reason&&(jQuery(".applepay-error").html("<div class='woocommerce-error'>"+t.reason+"</div>").show(),console.log(t.reason)))}};