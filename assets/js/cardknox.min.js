jQuery((function(e){"use strict";function o(o,r,n,c,t,a){const d={action:"get_data",xKey:wc_cardknox_params.xkey,xRefNum:c,xCavv:r,xEci:n,x3dsAuthenticationStatus:t,x3dsSignatureVerificationStatus:a,x3dsActionCode:o,x3dsError:ck3DS.error,xVersion:wc_cardknox_params.xVersion,xSoftwareName:wc_cardknox_params.xSoftwareName,xSoftwareVersion:wc_cardknox_params.xSoftwareVersion,xAllowDuplicate:1};e.ajax({type:"post",dataType:"json",url:wc_cardknox_params.threeds_object.ajax_url,data:d,success:function(o){"E"!=o.xResult&&"D"!=o.xResult||(e(".woocommerce-error, .woocommerce-message").remove(),e("form.checkout").prev(".woocommerce-notices-wrapper").append('<ul class="woocommerce-error" role="alert"><li>'+o.xError+"</li></ul>")),"A"==o.xResult&&(window.location.href=o.redirect)}})}e("form.checkout, form#order_review").on("change",'input[name="wc-cardknox-payment-token"]',(function(){"new"===e('.cardknox-legacy-payment-fields input[name="wc-cardknox-payment-token"]:checked').val()?e(".cardknox-legacy-payment-fields #cardknox-payment-data").slideDown(200):e(".cardknox-legacy-payment-fields #cardknox-payment-data").slideUp(200)})),window.onload=function(){"yes"==wc_cardknox_params.enable_3ds?enable3DS(wc_cardknox_params.threeds_env,o):enable3DS(wc_cardknox_params.threeds_env,null);let e={border:"1px solid black"},r={border:"1px solid green"},n={border:"1px solid red"};var c={outline:"none",border:"0","border-left-color":"rgb(67, 69, 75)",padding:"0.6180469716em",width:"225px",height:"auto","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit"},t={outline:"none",border:"0","border-left-color":"rgb(67, 69, 75)",padding:"0.6180469716em",width:"106px",height:"auto","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit"};/[?&](is)?debug/i.test(window.location.search)&&setDebugEnv(!0);parseQueryString(window.location.href);setIfieldStyle("ach",e),setIfieldStyle("card-number",c),setIfieldStyle("cvv",t),enableAutoFormatting(),enableLogging(),setAccount(wc_cardknox_params.key,"wordpress","0.1.2"),addIfieldCallback("input",(function(o){o.ifieldValueChanged&&(setIfieldStyle("card-number",o.cardNumberFormattedLength<=0?e:o.cardNumberIsValid?r:n),"cvv"===o.lastIfieldChanged?setIfieldStyle("cvv","unknown"===o.issuer||o.cvvLength<=0?e:o.cvvIsValid?r:n):"card-number"===o.lastIfieldChanged?"unknown"===o.issuer||o.cvvLength<=0?setIfieldStyle("cvv",e):"amex"===o.issuer?setIfieldStyle("cvv",4===o.cvvLength?r:n):setIfieldStyle("cvv",3===o.cvvLength?r:n):"ach"===o.lastIfieldChanged&&setIfieldStyle("ach",0===o.achLength?e:o.achIsValid?r:n))}));let a=setInterval((function(){clearInterval(a),focusIfield("card-number")}),1e3)};var r={init:function(){e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_cardknox",this.onSubmit).on("change",this.reset),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form#add_payment_method").on("submit",this.onSubmit),e(document).on("change","#wc-cardknox-cc-form :input",this.reset).on("cardknoxError",this.onError).on("checkout_error",this.reset)},isCardknoxChosen:function(){return e("#payment_method_cardknox").is(":checked")&&(!e('input[name="wc-cardknox-payment-token"]:checked').length||"new"===e('input[name="wc-cardknox-payment-token"]:checked').val())},hasExp:function(){return 0<e("input.xExp").length},block:function(){r.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){r.form.unblock()},onError:function(o,n){console.log("onError");var c=n;e(".wc-cardknox-error, .xExp").remove(),e("#ifieldsError").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-cardknox-error"><li>'+c+"</li></ul>"),r.unblock()},onSubmit:function(){return!(r.isCardknoxChosen()&&!r.hasExp())||(r.block(),getTokens((function(){return""===document.getElementsByName("xCardNum")[0].value?(e(document).trigger("cardknoxError","Card Number Required"),!1):""===document.getElementsByName("xCVV")[0].value?(e(document).trigger("cardknoxError","CVV Required"),!1):(r.onCardknoxResponse(),void jQuery(document.body).trigger("update_checkout"))}),(function(){return console.log("error"),e(document).trigger("cardknoxError",document.getElementById("ifieldsError").textContent),!1}),2e4),!1)},onCardknoxResponse:function(){if(document.querySelector("body").classList.contains("woocommerce-checkout")){if(console.log("Class woocommerce-cart exists!"),4!=(n=document.getElementById("cardknox-card-expiry").value.replace(/\s|\//g,"")).length)return e(document).trigger("cardknoxError","Invalid expiration date"),!1;let o=parseInt(n.substr(0,2)),c=parseInt(n.substr(2)),t=new Date,a=t.getFullYear()%100,d=t.getMonth()+1;if(c<a||c===a&&o<d)return e(document).trigger("cardknoxError","Expiration must be in the future"),!1;r.form.append("<input type='hidden' class='xExp' id='xExp' name='xExp' value='"+n+"'/>"),e.ajax({type:"POST",url:"?wc-ajax=checkout",data:e("form.woocommerce-checkout").serialize(),beforeSend:function(){},success:function(o){if("success"===o.result){let e=o.response;"V"==e.xResult&&e.xVerifyPayload&&""!==e.xVerifyPayload&&e.xVerifyURL&&""!==e.xVerifyURL&&verify3DS(e),"A"==e.xResult&&(window.location.href=o.redirect)}else e("form.woocommerce-checkout .blockUI.blockOverlay").hide(),e(".woocommerce-error, .woocommerce-message").remove(),r.form.prepend(o.messages);e("form.woocommerce-checkout .blockUI.blockOverlay").hide()},error:function(o,r,n){console.log("Error placing order:",r,n),e("form.woocommerce-checkout .blockUI.blockOverlay").hide()},complete:function(){e("form.woocommerce-checkout .blockUI.blockOverlay").hide()}})}else{console.log("Class woocommerce-cart does not exist!");var o=e("#cardknox-card-expiry").payment("cardExpiryVal"),n=o.month.toString()+o.year.toString().substr(2,2);console.log("onCardknoxResponse"),r.form.append("<input type='hidden' class='xExp' name='xExp' value='"+n+"'/>"),r.form.submit()}},reset:function(){e("#cardknox-card-cvc, #cardknox-card-number").val(""),e(".xExp").remove()}};r.init()})),jQuery(document).ready((function(){jQuery(document.body).on("updated_checkout",(function(){jQuery("#ap-container").hide();var e='input[name="payment_method"]',o='button[name="woocommerce_checkout_place_order"]';function r(){var r=jQuery(e+":checked").val();"cardknox-applepay"===r?(jQuery(o).hide(),jQuery("div#divGpay").hide(),jQuery("#ap-container").show(),jQuery(".applepay-error").show()):"cardknox-googlepay"===r?(jQuery(o).hide(),jQuery("div#divGpay").show(),jQuery("#ap-container").hide(),jQuery(".applepay-error").hide()):(jQuery(o).show(),jQuery("div#divGpay").hide(),jQuery("#ap-container").hide(),jQuery(".applepay-error").hide())}r(),jQuery(document).on("change",e,(function(){r()}))}))}));