let subTotal={total:parseFloat(googlePaysettings.total).toFixed(2)};function setGPPayload(e){document.getElementById("gp-payload").value=e,showHide("divGPPayload",e),e&&divGPPayload.scrollIntoView(!1)}function showHide(e,t){"string"==typeof e&&(e=document.getElementById(e)),e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))}function getAmount(){let e=subTotal.total;return parseFloat(e).toFixed(2)}function createWooCommerceOrder(e,t,n,o,i,a){jQuery.ajax({url:googlePaysettings.ajax_url,type:"POST",data:{action:"cardknox_create_order",google_pay_token:e,amount:t,phone:n,email:o,shippingAddress:JSON.stringify(i),shippingOptionData:JSON.stringify(a),security:googlePaysettings.create_order_nonce},success:function(e){e.success?window.location.href=e.data.redirect_url:(jQuery(".gpay-error").html("<div> "+e.data+" </div>").show(),setTimeout((function(){jQuery(".gpay-error").html("").hide()}),3e3))},error:function(e){console.log(e),jQuery(".gpay-error").html("<div> "+e.responseText+" </div>").show(),setTimeout((function(){jQuery(".gpay-error").html("").hide()}),3e3)}})}jQuery(document.body).on("updated_cart_totals",(function(){jQuery.ajax({url:googlePaysettings.ajax_url,type:"POST",data:{action:"update_cart_total"},success:function(e){e.success&&(subTotal.total=e.data.total)}}),""==googlePaysettings.merchant_name||null==googlePaysettings.merchant_name||0==googlePaysettings.merchant_name.length?jQuery(".googlepay-error").html("<div class='woocommerce-error' role='alert'>Please contact support. Failed to initialize Google Pay. </div>").show():ckGooglePay.enableGooglePay({initFunction:"gpRequest.initGP",amountField:"amount"})})),ckGooglePay.enableGooglePay({initFunction:"gpRequest.initGP",amountField:"amount"}),window.gpRequest={merchantInfo:{merchantName:googlePaysettings.merchant_name},buttonOptions:{buttonColor:googlePaysettings.button_style?googlePaysettings.button_style:"default",buttonSizeMode:GPButtonSizeMode.fill},billingParams:{phoneNumberRequired:!0,emailRequired:!0,billingAddressRequired:!0,billingAddressFormat:GPBillingAddressFormat.full},shippingParams:{phoneNumberRequired:!0,emailRequired:!0,onGetShippingCosts:function(e){return logDebug({label:"onGetShippingCosts",data:googlePaysettings.shippingData}),googlePaysettings.shippingCosts},onGetShippingOptions:function(e){logDebug({label:"onGetShippingOptions",data:e});const t=e&&e.shippingAddress;if(t&&"HI"==e.shippingAddress.administrativeArea)return{error:{reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:"This shipping option is invalid for the given address",intent:"SHIPPING_ADDRESS"}};let n="free_shipping";return t&&"shipping_option_unselected"!==e.shippingOptionData.id&&(n=e.shippingOptionData.id),{defaultSelectedOptionId:n,shippingOptions:googlePaysettings.shippingMethods}}},onGetTransactionInfo:function(e){logDebug({label:"onGetTransactionInfo",data:e});const t=parseFloat(subTotal.total).toFixed(2);let n=null;return n=null!==jQuery("#billing_country").val()&&void 0!==jQuery("#billing_country").val()?jQuery("#billing_country").val():"US",{displayItems:[{label:"Subtotal",type:"SUBTOTAL",price:t.toString()}],countryCode:n,currencyCode:googlePaysettings.currencyCode,totalPriceStatus:"FINAL",totalPrice:t.toString(),totalPriceLabel:"Total"}},onBeforeProcessPayment:function(){return new Promise((function(e,t){try{e(iStatus.success)}catch(e){t(e)}}))},onProcessPayment:function(e){let t=(e=JSON.parse(JSON.stringify(e))).transactionInfo.totalPrice,n=e.paymentData.paymentMethodData.info.billingAddress.phoneNumber;n=n.substring(n.indexOf(" ")+1);let o=e.paymentData.shippingOptionData;if(t<=0)throw jQuery(".gpay-error").html("<div> Payment is not authorized. Amount must be greater than 0 </div>").show(),setTimeout((function(){jQuery(".gpay-error").html("").hide()}),3e3),new Error("Payment is not authorized. Amount must be greater than 0");createWooCommerceOrder(btoa(e.paymentData.paymentMethodData.tokenizationData.token),t,n,e.paymentData.email,e.paymentData.shippingAddress,o)},onPaymentCanceled:function(e){jQuery(".gpay-error").html("<div> Payment was canceled </div>").show(),setTimeout((function(){jQuery(".gpay-error").html("").hide()}),3e3)},handleResponse:function(e){const t=JSON.parse(e);t&&(t.xError?setTimeout((function(){alert(`There was a problem with your order (${t.xRefNum})!`)}),500):setTimeout((function(){alert(`Thank you for your order (${t.xRefNum})!`)}),500))},getGPEnvironment:function(){return googlePaysettings.environment?googlePaysettings.environment:"TEST"},initGP:function(){return{merchantInfo:this.merchantInfo,buttonOptions:this.buttonOptions,environment:this.getGPEnvironment(),billingParameters:this.billingParams,shippingParameters:{emailRequired:this.shippingParams.emailRequired,onGetShippingCosts:"gpRequest.shippingParams.onGetShippingCosts",onGetShippingOptions:"gpRequest.shippingParams.onGetShippingOptions"},onGetTransactionInfo:"gpRequest.onGetTransactionInfo",onBeforeProcessPayment:"gpRequest.onBeforeProcessPayment",onProcessPayment:"gpRequest.onProcessPayment",onPaymentCanceled:"gpRequest.onPaymentCanceled",onGPButtonLoaded:"gpRequest.gpButtonLoaded",isDebug:isDebugEnv}},gpButtonLoaded:function(e){e&&(e.status===iStatus.success?showHide("divGpay",!0):e.reason&&logDebug({label:"gpButtonLoaded",data:e.reason}))}};