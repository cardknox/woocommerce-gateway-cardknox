function setAPPayload(e){console.log(e)}function showHide(e,t){"string"==typeof e&&(e=document.getElementById(e)),e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))}function getAmount(){var e=applePaysettings.total;return parseFloat(e).toFixed(2)}function getApButtonColor(e){var t=APButtonColor.black;switch(e.button_style){case"black":default:t=APButtonColor.black;break;case"white":t=APButtonColor.white;break;case"whiteOutline":t=APButtonColor.whiteOutline}return t}function getApButtonType(e){var t=APButtonType.pay;switch(e.button_type){case"pay":default:t=APButtonType.pay;break;case"buy":t=APButtonType.buy;break;case"plain":t=APButtonType.plain;break;case"order":t=APButtonType.order;break;case"donate":t=APButtonType.donate;break;case"continue":t=APButtonType.continue;break;case"checkout":t=APButtonType.checkout}return t}jQuery(document.body).on("updated_checkout",(function(){""==applePaysettings.merchant_identifier||null==applePaysettings.merchant_identifier||0==applePaysettings.merchant_identifier.length?jQuery(".applepay-error").html("<div class='woocommerce-error' role='alert'>Please contact support. Failed to initialize Apple Pay. </div>").show():ckApplePay.enableApplePay({initFunction:"apRequest.initAP",amountField:"amount"})})),window.apRequest={buttonOptions:{buttonContainer:"ap-container",buttonColor:getApButtonColor(applePaysettings),buttonType:getApButtonType(applePaysettings)},totalAmount:null,taxAmt:null,shippingMethod:null,creditType:null,getTransactionInfo:function(){try{return{total:{type:"final",label:"Total",amount:getAmount().toString()}}}catch(e){console.error("getTransactionInfo error ",exMsg(e))}},onGetTransactionInfo:function(){try{return this.getTransactionInfo()}catch(e){console.error("onGetTransactionInfo error ",exMsg(e))}},onPaymentMethodSelected:function(e){const t=this;return new Promise(((o,n)=>{try{console.log("paymentMethod",JSON.stringify(e));o(t.getTransactionInfo(null,null,e.type))}catch(e){exMsg(e);console.error("onPaymentMethodSelected error.",exMsg(e)),n({errors:[e]})}}))},validateApplePayMerchant:function(){return new Promise(((e,t)=>{try{var o=new XMLHttpRequest;o.open("POST","https://api.cardknox.com/applepay/validate"),o.onload=function(){this.status>=200&&this.status<300?(console.log("validateApplePayMerchant",JSON.stringify(o.response)),e(o.response)):(console.error("validateApplePayMerchant",JSON.stringify(o.response),this.status),t({status:this.status,statusText:o.response}))},o.onerror=function(){console.error("validateApplePayMerchant",o.statusText,this.status),t({status:this.status,statusText:o.statusText})},o.setRequestHeader("Content-Type","application/json"),o.send()}catch(e){setTimeout((function(){console.log("getApplePaySession error: "+exMsg(e))}),100)}}))},onValidateMerchant:function(){return new Promise(((e,t)=>{try{this.validateApplePayMerchant().then((o=>{try{console.log(o),e(o)}catch(e){console.error("validateApplePayMerchant exception.",JSON.stringify(e)),t(e)}})).catch((e=>{console.error("validateApplePayMerchant error.",JSON.stringify(e)),t(e)}))}catch(e){console.error("onValidateMerchant error.",JSON.stringify(e)),t(e)}}))},authorize:function(e,t){if(console.log(e),!e.token.paymentData.data)throw new Error("Apple Pay token data is missing");var o=btoa(JSON.stringify(e.token.paymentData));jQuery("input[name='xCardNumToken']").remove(),jQuery("<input>").attr({type:"hidden",name:"xCardNumToken",value:o}).appendTo("form.checkout"),jQuery("#place_order").trigger("click")},onPaymentAuthorize:function(e){const t=getAmount();return new Promise(((o,n)=>{try{this.authorize(e,t.toString()).then((n=>{try{console.log(n),this.authorize(e,t.toString()),o(!0)}catch(e){throw e}})).catch((e=>{console.error("authorizeAPay error.",JSON.stringify(e)),apRequest.handleAPError(e),n(e)}))}catch(e){console.error("onPaymentAuthorize error.",JSON.stringify(e)),apRequest.handleAPError(e),n(e)}}))},handleAPError:function(e){e&&e.xRefNum?setAPPayload("There was a problem with your order:("+e.xRefNum+")"):setAPPayload("There was a problem with your order:"+exMsg(e))},initAP:function(){return{buttonOptions:this.buttonOptions,merchantIdentifier:applePaysettings.merchant_identifier,requiredBillingContactFields:["postalAddress","name","phone","email"],requiredShippingContactFields:["postalAddress","name","phone","email"],onGetTransactionInfo:"apRequest.onGetTransactionInfo",onGetShippingMethods:"apRequest.onGetShippingMethods",onPaymentMethodSelected:"apRequest.onPaymentMethodSelected",onValidateMerchant:"apRequest.onValidateMerchant",onPaymentAuthorize:"apRequest.onPaymentAuthorize",onPaymentComplete:"apRequest.onPaymentComplete",onAPButtonLoaded:"apRequest.apButtonLoaded",isDebug:!0}},isSupportedApplePay:function(){return!(!window.ApplePaySession||!ApplePaySession.canMakePayments())},apButtonLoaded:function(e){e&&(e.status===iStatus.success?showHide(this.buttonOptions.buttonContainer,!0):e.reason&&(jQuery(".applepay-error").html("<div class='woocommerce-error'>"+e.reason+"</div>").show(),console.log(e.reason)),0==this.isSupportedApplePay()?jQuery(".woocommerce-checkout .payment_method_cardknox-applepay").hide():jQuery(".woocommerce-checkout .payment_method_cardknox-applepay").show())}};