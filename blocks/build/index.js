(()=>{"use strict";const e=window.wp.i18n,r=window.wp.htmlEntities,t=window.wp.element,n=window.ReactJSXRuntime,o=wcCardknoxData?.cardLogoUrl||"",a=({errors:r,onExpiryChange:a,ValidationInputError:i,cardData:d})=>{const c=()=>{if(!d.expiryMonth||!d.expiryYear)return!1;const e=new Date,r=e.getFullYear(),t=e.getMonth()+1,n=parseInt(d.expiryMonth,10),o=parseInt(d.expiryYear,10);return!(o<r||o===r&&n<t)};return(0,t.useEffect)(()=>{const e=document.querySelector(".cardknox-iframe-container"),r=document.querySelector(".cvv-container");e&&(e.style.border="0"),r&&(r.style.border="0")},[]),(0,n.jsxs)("div",{className:"wc-cardknox-ifields credit-row",children:[(0,n.jsx)("div",{id:"ifieldsError",style:{display:"none",color:"red",marginBottom:"10px"}}),(0,n.jsxs)("div",{className:"form-row form-row-wide",style:{paddingBottom:"0",margin:"0 0 15px 0",width:"100%"},children:[(0,n.jsxs)("label",{style:{margin:"0 0 5px 0",lineHeight:"inherit",display:"block",fontWeight:400},htmlFor:"cardknox-card-number",children:[(0,e.__)("Card Number","woocommerce-gateway-cardknox")," ",(0,n.jsx)("span",{className:"required",children:"*"})]}),(0,n.jsxs)("div",{className:"cardknox-card-number-wrapper",style:{position:"relative"},children:[(0,n.jsx)("div",{className:"cardknox-iframe-container",style:{position:"relative",overflow:"hidden",backgroundColor:"#fff",height:"65px"},children:(0,n.jsx)("iframe",{"data-ifields-id":"card-number","data-ifields-placeholder":(0,e.__)("Card Number","woocommerce-gateway-cardknox"),src:"https://cdn.cardknox.com/ifields/3.3.2601.2901/ifield.htm",frameBorder:"0",width:"100%",height:"100%",style:{border:0},title:"Card Number"})}),(0,n.jsx)("div",{className:"card-logos",style:{position:"absolute",right:"50px",top:"40%",transform:"translateY(-50%)",height:"40px",width:"100%",backgroundImage:`url(${o})`,backgroundSize:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"center right",pointerEvents:"none"}})]}),(0,n.jsxs)("div",{className:"cardknox-error-container",children:[(0,n.jsx)("div",{"data-ifields-id":"card-number-error"}),r.cardNumber&&(0,n.jsx)(i,{errorMessage:r.cardNumber})]})]}),(0,n.jsxs)("div",{className:"cardknox-row",style:{display:"flex",gap:"15px",marginBottom:"0px"},children:[(0,n.jsxs)("div",{className:"form-row form-row-first",style:{flex:"1",margin:"0"},children:[(0,n.jsxs)("label",{style:{margin:"0 0 5px 0",lineHeight:"inherit",display:"block",fontWeight:400},htmlFor:"cardknox-expiry",children:[(0,e.__)("Expiry (MM/YY)","woocommerce-gateway-cardknox")," ",(0,n.jsx)("span",{className:"required",children:"*"})]}),(0,n.jsx)("input",{id:"cardknox-card-expiry",className:"input-text wc-credit-card-form-card-expiry",inputMode:"numeric",autoComplete:"cc-exp",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",type:"tel",placeholder:(0,e.__)("MM / YY","woocommerce-gateway-cardknox"),style:{outline:"none",border:r.expiry||!c()&&d.expiryMonth&&d.expiryYear?"1px solid red":"1px solid #000",borderRadius:"4px",padding:"0.618047em",width:"100%",height:"48px",backgroundColor:"#fff",fontWeight:"inherit",boxSizing:"border-box",fontSize:"16px"},onChange:e=>{const r=e.target.value.replace(/\D/g,"");let t=r;if(r.length>=2&&(t=r.substr(0,2)+" / "+r.substr(2,2)),e.target.value=t,r.length>=2){const e=r.substr(0,2);a("expiryMonth",e)}if(4===r.length){const e="20"+r.substr(2,2);a("expiryYear",e)}}}),(r.expiry||!c()&&d.expiryMonth&&d.expiryYear)&&(0,n.jsx)(i,{errorMessage:r.expiry||(0,e.__)("Expiration must be in the future","woocommerce-gateway-cardknox")})]}),(0,n.jsxs)("div",{className:"form-row form-row-last",style:{flex:"1",margin:"0"},children:[(0,n.jsxs)("label",{style:{margin:"0 0 5px 0",lineHeight:"inherit",display:"block",fontWeight:400},htmlFor:"cardknox-cvv",children:[(0,e.__)("CVV Code","woocommerce-gateway-cardknox")," ",(0,n.jsx)("span",{className:"required",children:"*"})]}),(0,n.jsx)("div",{className:"cardknox-iframe-container cvv-container",style:{position:"relative",overflow:"hidden",backgroundColor:"#fff",height:"65px"},children:(0,n.jsx)("iframe",{"data-ifields-id":"cvv","data-ifields-placeholder":(0,e.__)("CVV","woocommerce-gateway-cardknox"),src:"https://cdn.cardknox.com/ifields/3.3.2601.2901/ifield.htm",frameBorder:"0",width:"100%",height:"100%",style:{border:0},title:"CVV"})}),(0,n.jsx)("div",{"data-ifields-id":"cvv-error"}),r.cvv&&(0,n.jsx)(i,{errorMessage:r.cvv})]})]}),(0,n.jsx)("input",{type:"hidden","data-ifields-id":"card-number-token",name:"xCardNum"}),(0,n.jsx)("input",{type:"hidden","data-ifields-id":"cvv-token",name:"xCVV"}),(0,n.jsx)("div",{className:"clear"})]})},i=({checked:r,onChange:t})=>(0,n.jsx)("div",{className:"wc-payment-gateway-cardknox__save-payment-method wc-block-components-payment-methods__save-card-info",children:(0,n.jsxs)("label",{className:"wc-block-components-checkbox wc-block-components-payment-methods__save-card-infos-checkbox",children:[(0,n.jsx)("input",{type:"checkbox",name:"wc-cardknox-new-payment-method",id:"wc-cardknox-new-payment-method",className:"wc-block-components-checkbox__input",checked:r,onChange:e=>t(e.target.checked)}),(0,n.jsx)("svg",{className:"wc-block-components-checkbox__mark","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 20",children:(0,n.jsx)("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})}),(0,n.jsx)("span",{className:"wc-block-components-checkbox__label",children:(0,e.__)("Save payment information to my account for future purchases.","woocommerce-gateway-cardknox")})]})}),d=r=>{const o=r.eventRegistration||r.events,d=r.emitResponse,c=r.components||{},s=window.wc&&window.wc.wcSettings?window.wc.wcSettings.getSetting("cardknox_data",{}):window.wcSettings?window.wcSettings.getSetting("cardknox_data",{}):{},[l,u]=(0,t.useState)({}),[m,w]=(0,t.useState)(!1),[f,x]=(0,t.useState)(!1),[p,y]=(0,t.useState)("new"),[v,b]=(0,t.useState)({cardNumber:"",cvv:"",expiryMonth:"",expiryYear:"",cardNumberToken:"",cvvToken:""}),h=(0,t.useRef)(0),g=(0,t.useRef)(null),k=(0,t.useRef)(v),S=(0,t.useRef)(d),I=(0,t.useRef)(null),C=(0,t.useRef)(v),_=(0,t.useRef)(f),N=(0,t.useRef)(p),E=(0,t.useRef)(l),V=(0,t.useRef)(o),j=(0,t.useRef)({subscribed:!1,unsubscribe:null});(0,t.useEffect)(()=>{h.current+=1});const{initializeIFields:q,getTokens:M,clearFields:R,focusField:T}=(()=>{const e=(0,t.useRef)(!1),r=(0,t.useRef)(null),n=()=>{document.querySelectorAll(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").forEach(e=>e.remove())};return{initializeIFields:(0,t.useCallback)(({iFieldsKey:t,softwareName:o,softwareVersion:a,onUpdate:i})=>{if(e.current)return;if(!window.setAccount)return;r.current=i||null,window.setAccount(t,o,a);const d={outline:"none",border:"1px solid #c3c3c3","border-radius":"4px",padding:"0.6180469716em",width:"93%",height:"30px","background-color":"transparent","font-weight":"inherit","box-shadow":"none","font-size":"16px","font-family":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},c={outline:"none",border:"1px solid #c3c3c3","border-radius":"4px",padding:"0.6180469716em",width:"86%",height:"28px","background-color":"transparent","font-weight":"inherit","box-shadow":"none","font-size":"16px","font-family":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},s={...d,border:"1px solid #46b450","background-color":"#f0f9f0"},l={...d,border:"1px solid #d63638","background-color":"#fef5f5"},u={...c,border:"1px solid #46b450","background-color":"#f0f9f0"},m={...c,border:"1px solid #d63638","background-color":"#fef5f5"};window.setIfieldStyle&&(window.setIfieldStyle("card-number",d),window.setIfieldStyle("cvv",c)),window.enableAutoFormatting&&window.enableAutoFormatting(),window.enableEnterKey&&(window.enableEnterKey("card-number"),window.enableEnterKey("cvv")),window.addIfieldCallback&&window.setIfieldStyle?(window.addIfieldCallback("input",function(e){r.current?.(e);const t=document.querySelector('[data-ifields-id="card-number-error"]'),o=document.querySelector('[data-ifields-id="cvv-error"]'),a="number"==typeof e.cardNumberLength?e.cardNumberLength:0,i="number"==typeof e.cvvLength?e.cvvLength:0;window.setIfieldStyle("card-number",a<=0?d:e.cardNumberIsValid?s:l),t&&(t.textContent=a<=0?"Card Number is required":e.cardNumberIsValid?"":"Invalid card number",t.setAttribute("aria-hidden",t.textContent?"false":"true"));const w=i===("amex"===e.issuer?4:3)&&e.cvvIsValid;window.setIfieldStyle("cvv","unknown"===e.issuer||i<=0?c:w?u:m),o&&(o.textContent=i<=0?"CVV is required":w?"":"Invalid CVV",o.setAttribute("aria-hidden",o.textContent?"false":"true")),e.cardNumberIsValid&&w&&n()}),window.addIfieldCallback("issuerupdated",function(e){const r="number"==typeof e.cvvLength?e.cvvLength:0,t=r===("amex"===e.issuer?4:3)&&e.cvvIsValid;window.setIfieldStyle("cvv","unknown"===e.issuer||r<=0?c:t?u:m)})):window.addIfieldKeyPressCallback&&window.setIfieldStyle&&window.addIfieldKeyPressCallback(function(e){r.current?.(e);const t=document.querySelector('[data-ifields-id="card-number-token"]')?.value,o=document.querySelector('[data-ifields-id="cvv-token"]')?.value,a=document.querySelector('[data-ifields-id="card-number-error"]'),i=document.querySelector('[data-ifields-id="cvv-error"]');t||e.cardNumberIsValid?(window.setIfieldStyle("card-number",s),a&&(a.textContent="")):e.cardNumberLength>0?(window.setIfieldStyle("card-number",l),a&&(a.textContent="Invalid card number")):(window.setIfieldStyle("card-number",d),a&&(a.textContent="Card Number is required")),o||e.cvvIsValid?(window.setIfieldStyle("cvv",u),i&&(i.textContent="")):e.cvvLength>0?(window.setIfieldStyle("cvv",m),i&&(i.textContent="Invalid CVV")):(window.setIfieldStyle("cvv",c),i&&(i.textContent="CVV is required")),(t||e.cardNumberIsValid)&&(o||e.cvvIsValid)&&n()}),e.current=!0},[]),getTokens:(0,t.useCallback)(()=>new Promise((e,r)=>{if(!window.getTokens)return void r(new Error("iFields not initialized"));const t=document.querySelector('[data-ifields-id="card-number-token"]')?.value,o=document.querySelector('[data-ifields-id="cvv-token"]')?.value;if(t&&o)return n(),void e({cardNumberToken:t,cvvToken:o});const a=document.querySelector('[data-ifields-id="card-number-error"]'),i=document.querySelector('[data-ifields-id="cvv-error"]');a&&(a.textContent=""),i&&(i.textContent="");let d=!1;const c=setTimeout(()=>{d||(d=!0,r(new Error("Timed out while validating card fields")))},15e3);window.getTokens(()=>{if(d)return;d=!0,clearTimeout(c);const t=document.querySelector('[data-ifields-id="card-number-token"]')?.value,o=document.querySelector('[data-ifields-id="cvv-token"]')?.value;if(!t||!o)return t||(a&&(a.textContent="Card Number is required"),window.setIfieldStyle&&window.setIfieldStyle("card-number",{border:"1px solid #d63638"}),window.focusIfield&&window.focusIfield("card-number")),o||(i&&(i.textContent="CVV is required"),window.setIfieldStyle&&window.setIfieldStyle("cvv",{border:"1px solid #d63638"}),t&&window.focusIfield&&window.focusIfield("cvv")),void r(new Error("Please fill in all required fields"));window.setIfieldStyle&&window.setIfieldStyle("card-number",{border:"1px solid #46b450"}),window.setIfieldStyle&&window.setIfieldStyle("cvv",{border:"1px solid #46b450"}),a&&(a.textContent="",a.setAttribute("aria-hidden","true")),i&&(i.textContent="",i.setAttribute("aria-hidden","true")),n(),e({cardNumberToken:t,cvvToken:o})},e=>{if(d)return;d=!0,clearTimeout(c);const t=document.querySelector('[data-ifields-id="card-number-error"]'),n=document.querySelector('[data-ifields-id="cvv-error"]');if(t&&!t.textContent&&(t.textContent="Invalid card number"),n&&!n.textContent&&(n.textContent="Invalid CVV"),window.focusIfield){const e=window.getLastIfieldState&&window.getLastIfieldState(),r=e&&e.cardNumberIsValid?"cvv":"card-number";window.focusIfield(r)}r(new Error("string"==typeof e?e:"Failed to get tokens"))},15e3)}),[]),clearFields:(0,t.useCallback)(()=>{window.clearIfield&&(window.clearIfield("card-number"),window.clearIfield("cvv"))},[]),focusField:(0,t.useCallback)(e=>{window.focusIfield&&window.focusIfield(e)},[])}})();(0,t.useEffect)(()=>{S.current=d},[d]),(0,t.useEffect)(()=>{I.current=M},[M]),(0,t.useEffect)(()=>{C.current=v},[v]),(0,t.useEffect)(()=>{_.current=f},[f]),(0,t.useEffect)(()=>{N.current=p},[p]),(0,t.useEffect)(()=>{E.current=l},[l]),(0,t.useEffect)(()=>{V.current=o},[o]),(0,t.useEffect)(()=>{g.current,g.current=M},[M]),(0,t.useEffect)(()=>{k.current,k.current=v},[v]);const F=c.ValidationInputError||(({errorMessage:e})=>e?(0,n.jsx)("div",{className:"wc-block-components-validation-error",role:"alert",children:(0,n.jsx)("span",{children:e})}):null);(0,t.useEffect)(()=>{const e=()=>{const e=!!s.iFieldsKey,r=!!window.setAccount&&!!window.setIfieldStyle&&!!window.addIfieldCallback;e&&r&&q({iFieldsKey:s.iFieldsKey,softwareName:s.softwareName||"WooCommerce",softwareVersion:s.softwareVersion||"1.0.0",onUpdate:L})};e();const r=window.setTimeout(e,300);return()=>{window.clearTimeout(r)}},[s.iFieldsKey]),(0,t.useEffect)(()=>{let r=!1,t=null;const n=()=>{if(r||j.current.subscribed)return;const o=V.current,a=o?.onPaymentSetup,i=o?.onPaymentProcessing,d=a||i;if(!d||!S.current)return void(t=window.setTimeout(n,200));const c=d(async()=>{const r=S.current,t=N.current,n=C.current;try{if("new"!==t)return{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:{wc_token:t}}};const o=(r=>{const t={};if(r.expiryMonth){const n=parseInt(r.expiryMonth,10);(n<1||n>12)&&(t.expiry=(0,e.__)("Invalid expiry month","woocommerce-gateway-cardknox"))}else t.expiry=(0,e.__)("Expiry month is required","woocommerce-gateway-cardknox");if(r.expiryYear){const n=(new Date).getFullYear(),o=parseInt(r.expiryYear,10);if(o<n&&(t.expiry=(0,e.__)("Card has expired","woocommerce-gateway-cardknox")),o===n&&r.expiryMonth){const n=(new Date).getMonth()+1;parseInt(r.expiryMonth,10)<n&&(t.expiry=(0,e.__)("Card has expired","woocommerce-gateway-cardknox"))}}else t.expiry=(0,e.__)("Expiry year is required","woocommerce-gateway-cardknox");return t})(n)||{};if(n.expiryMonth&&n.expiryYear){const r=new Date,t=r.getFullYear(),a=r.getMonth()+1,i=parseInt(n.expiryMonth,10),d=parseInt(n.expiryYear,10);(d<t||d===t&&i<a)&&(o.expiry=(0,e.__)("Expiration must be in the future","woocommerce-gateway-cardknox"))}else o.expiry=(0,e.__)("Expiry date is required","woocommerce-gateway-cardknox");if(Object.keys(o).length>0)return u(o),{type:r.responseTypes.ERROR,message:(0,e.__)("Please check your card details.","woocommerce-gateway-cardknox")};u({});const a=await I.current();return a?.cardNumberToken&&a?.cvvToken?{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:{cardknox_card_token:a.cardNumberToken,cardknox_cvv_token:a.cvvToken,cardknox_exp_month:n.expiryMonth,cardknox_exp_year:n.expiryYear,cardknox_save_card:_.current?"yes":"no","wc-cardknox-new-payment-method":_.current?"1":""}}}:{type:r.responseTypes.ERROR,message:(0,e.__)("Unable to process card data. Please try again.","woocommerce-gateway-cardknox")}}catch(t){return{type:r.responseTypes.ERROR,message:t?.message||(0,e.__)("Payment processing failed.","woocommerce-gateway-cardknox")}}});j.current={subscribed:!0,unsubscribe:c}};return n(),()=>{r=!0,t&&window.clearTimeout(t);const{unsubscribe:e}=j.current||{};"function"==typeof e&&e()}},[]);const L=(0,t.useCallback)(r=>{const t={...l},n=document.querySelector('[data-ifields-id="card-number-token"]')?.value,o=document.querySelector('[data-ifields-id="cvv-token"]')?.value;"card-number"!==r.lastActiveField&&void 0===r.cardNumberLength||(n||r.cardNumberIsValid?delete t.cardNumber:r.cardNumberLength>0&&!r.cardNumberIsValid?t.cardNumber=(0,e.__)("Invalid card number","woocommerce-gateway-cardknox"):delete t.cardNumber),"cvv"!==r.lastActiveField&&void 0===r.cvvLength||(o||r.cvvIsValid?delete t.cvv:r.cvvLength>0&&!r.cvvIsValid?t.cvv=(0,e.__)("Invalid CVV","woocommerce-gateway-cardknox"):delete t.cvv),u(t);const a=!(!n&&!r.cardNumberIsValid),i=!(!o&&!r.cvvIsValid);w(a&&i);const d=document.querySelector(".cardknox-iframe-container"),c=document.querySelector(".cvv-container");d&&(d.style.border="0"),c&&(c.style.border="0")},[l]);return(0,n.jsx)("div",{className:"wc-cardknox-payment-form",children:"new"===p&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a,{errors:l,onExpiryChange:(e,r)=>{b(t=>({...t,[e]:r}));const t={...l};delete t.expiry,u(t)},ValidationInputError:F,cardData:v}),s.showSaveOption&&(0,n.jsx)(i,{checked:f,onChange:x})]})})};var c,s;const l=window.wc&&window.wc.wcSettings?window.wc.wcSettings.getSetting("cardknox_data",{}):window.wcSettings?window.wcSettings.getSetting("cardknox_data",{}):{},u=(0,e.__)("Credit Card (Sola)","woocommerce-gateway-cardknox"),m=(0,r.decodeEntities)(l.title)||u,w=e=>(0,t.createElement)(d,e),f={name:"cardknox",label:(0,t.createElement)(()=>(0,t.createElement)("span",null,m)),content:(0,t.createElement)(w),edit:(0,t.createElement)(w),canMakePayment:()=>!0,ariaLabel:m,supports:{features:null!==(c=l.supports)&&void 0!==c?c:["products"],showSaveOption:null!==(s=l.showSaveOption)&&void 0!==s&&s,showSavedCards:Array.isArray(l.savedCards)&&l.savedCards.length>0},placeOrderButtonLabel:(0,e.__)("Place Order","woocommerce-gateway-cardknox")},{registerPaymentMethod:x}=window.wc.wcBlocksRegistry;x&&x(f)})();