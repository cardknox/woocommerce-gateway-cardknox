jQuery(function($){"use strict";$("form.checkout, form#order_review").on("change",'input[name="wc-cardknox-payment-token"]',function(){if("new"===$('.cardknox-legacy-payment-fields input[name="wc-cardknox-payment-token"]:checked').val()){$(".cardknox-legacy-payment-fields #cardknox-payment-data").slideDown(200)}else{$(".cardknox-legacy-payment-fields #cardknox-payment-data").slideUp(200)}});var wc_cardknox_form={init:function(){this.onIfieldloaded();if($("form.woocommerce-checkout").length){this.form=$("form.woocommerce-checkout")}
$("form.woocommerce-checkout").on("checkout_place_order_cardknox",this.onSubmit).on("change",this.reset);if($("form#order_review").length){this.form=$("form#order_review")}
$("form#order_review").on("submit",this.onSubmit);if($("form#add_payment_method").length){this.form=$("form#add_payment_method")}
$("form#add_payment_method").on("submit",this.onSubmit);$(document).on("change","#wc-cardknox-cc-form :input",this.reset).on("cardknoxError",this.onError).on("checkout_error",this.reset)},isCardknoxChosen:function(){return($("#payment_method_cardknox").is(":checked")&&(!$('input[name="wc-cardknox-payment-token"]:checked').length||"new"===$('input[name="wc-cardknox-payment-token"]:checked').val()))},hasExp:function(){return 0<$("input.xExp").length},block:function(){wc_cardknox_form.form.block({message:null,overlayCSS:{background:"#fff",opacity:0.6,},})},unblock:function(){wc_cardknox_form.form.unblock()},onError:function(e,responseObject){console.log("onError");var message=responseObject;$(".wc-cardknox-error, .xExp").remove();$("#ifieldsError").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-cardknox-error"><li>'+message+"</li></ul>");wc_cardknox_form.unblock()},onSubmit:function(e){console.log("onSubmit");if(wc_cardknox_form.isCardknoxChosen()&&!wc_cardknox_form.hasExp()){e.preventDefault();wc_cardknox_form.block();getTokens(function(){if(document.getElementsByName("xCardNum")[0].value===""){$(document).trigger("cardknoxError","Card Number Required");return!1}
if(document.getElementsByName("xCVV")[0].value===""){$(document).trigger("cardknoxError","CVV Required");return!1}
wc_cardknox_form.onCardknoxResponse()},function(){console.log("error");$(document).trigger("cardknoxError",document.getElementById("ifieldsError").textContent);return!1},30000);return!1}
return!0},onCardknoxResponse:function(){var xExp=document.getElementById("cardknox-card-expiry").value.replace(/\s|\//g,"");if(xExp.length!=4){$(document).trigger("cardknoxError","Invalid expiration date");return!1}
let month=parseInt(xExp.substr(0,2));let year=parseInt(xExp.substr(2));let currentDate=new Date();let currentYear=currentDate.getFullYear()%100;let currentMonth=currentDate.getMonth()+1;if(year<currentYear||(year===currentYear&&month<currentMonth)){$(document).trigger("cardknoxError","Expiration must be in the future");return!1}
wc_cardknox_form.form.append("<input type='hidden' class='xExp' id='xExp' name='xExp' value='"+xExp+"'/>");wc_cardknox_form.form.submit()},reset:function(){$("#cardknox-card-cvc, #cardknox-card-number").val("");$(".xExp").remove()},onIfieldloaded:function(){enableLogging();setAccount(wc_cardknox_params.key,"wordpress","0.1.2");var card_style={outline:"none",border:"1px solid #c3c3c3","border-radius":"4px",padding:"0.6180469716em",width:"93%",height:"30px","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit","background-image":"url("+$('.payment_method_cardknox label').find('img').attr('src')+")","background-size":"32%","background-repeat":"no-repeat","background-position":"right 10px center"};var cvv_style={outline:"none",border:"1px solid #c3c3c3","border-radius":"4px",padding:"0.6180469716em",width:"85%",height:"30px","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit",};function applyStyles(){if(window.matchMedia("(max-width: 767px)").matches){card_style.width="100%";card_style.height="48px";cvv_style.width="100%";cvv_style.height="48px";card_style["box-sizing"]="border-box";cvv_style["box-sizing"]="border-box"}else{card_style.width="93%";cvv_style.width="85%"}
setIfieldStyle("card-number",card_style);setIfieldStyle("cvv",cvv_style)}
applyStyles();window.addEventListener("resize",applyStyles);enableAutoFormatting();addIfieldCallback("input",function(data){if(data.ifieldValueChanged){setIfieldStyle("card-number",data.cardNumberFormattedLength<=0?defaultStyle:data.cardNumberIsValid?validStyle:invalidStyle);if(data.lastIfieldChanged==="cvv"){setIfieldStyle("cvv",data.issuer==="unknown"||data.cvvLength<=0?defaultStyle:data.cvvIsValid?validStyle:invalidStyle)}else if(data.lastIfieldChanged==="card-number"){if(data.issuer==="unknown"||data.cvvLength<=0){setIfieldStyle("cvv",defaultStyle)}else if(data.issuer==="amex"){setIfieldStyle("cvv",data.cvvLength===4?validStyle:invalidStyle)}else{setIfieldStyle("cvv",data.cvvLength===3?validStyle:invalidStyle)}}else if(data.lastIfieldChanged==="ach"){setIfieldStyle("ach",data.achLength===0?defaultStyle:data.achIsValid?validStyle:invalidStyle)}}});addIfieldCallback("issuerupdated",function(data){setIfieldStyle("cvv",data.issuer==="unknown"||data.cvvLength<=0?defaultStyle:data.cvvIsValid?validStyle:invalidStyle)})},};wc_cardknox_form.init()});jQuery(document).ready(function(){jQuery(document.body).on("updated_checkout",function(){jQuery("#ap-container").hide();var paymentMethodSelect='input[name="payment_method"]';var placeOrderButton='button[name="woocommerce_checkout_place_order"]';hidePlaceOrderButton();jQuery(document).on("change",paymentMethodSelect,function(){hidePlaceOrderButton()});function hidePlaceOrderButton(){var selectedPaymentMethod=jQuery(paymentMethodSelect+":checked").val();if(selectedPaymentMethod==="cardknox-applepay"){jQuery(placeOrderButton).hide();jQuery("div#divGpay").hide();jQuery("#ap-container").show();jQuery(".applepay-error").show()}else if(selectedPaymentMethod==="cardknox-googlepay"){jQuery(placeOrderButton).hide();jQuery("div#divGpay").show();jQuery("#ap-container").hide();jQuery(".applepay-error").hide()}else{jQuery(placeOrderButton).show();jQuery("div#divGpay").hide();jQuery("#ap-container").hide();jQuery(".applepay-error").hide()}}})})