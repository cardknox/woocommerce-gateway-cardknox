function setAPPayload(t){console.log(t)}function showHide(t,e){"string"==typeof t&&(t=document.getElementById(t)),t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}function getAmount(){return parseFloat(applePaysettings.total).toFixed(2)}function getApButtonColor(t){var e=APButtonColor.black;switch(t.button_style){case"black":default:e=APButtonColor.black;break;case"white":e=APButtonColor.white;break;case"whiteOutline":e=APButtonColor.whiteOutline}return e}function getApButtonType(t){var e=APButtonType.pay;switch(t.button_type){case"pay":default:e=APButtonType.pay;break;case"buy":e=APButtonType.buy;break;case"plain":e=APButtonType.plain;break;case"order":e=APButtonType.order;break;case"donate":case"donate":e=APButtonType.donate;break;case"continue":e=APButtonType.continue;break;case"checkout":e=APButtonType.checkout}return e}jQuery(document.body).on("updated_checkout",function(){""==applePaysettings.merchant_identifier||null==applePaysettings.merchant_identifier||0==applePaysettings.merchant_identifier.length?jQuery(".applepay-error").html("<div class='woocommerce-error' role='alert'>Please contact support. Failed to initialize Apple Pay. </div>").show():ckApplePay.enableApplePay({initFunction:"apRequest.initAP",amountField:"amount"})}),window.apRequest={buttonOptions:{buttonContainer:"ap-container",buttonColor:getApButtonColor(applePaysettings),buttonType:getApButtonType(applePaysettings)},totalAmount:null,taxAmt:null,shippingMethod:null,creditType:null,getTransactionInfo:function(){try{return{total:{type:"final",label:"Total",amount:getAmount().toString()}}}catch(t){console.error("getTransactionInfo error ",exMsg(t))}},onGetTransactionInfo:function(){try{return this.getTransactionInfo()}catch(t){console.error("onGetTransactionInfo error ",exMsg(t))}},onPaymentMethodSelected:function(t){let e=this;return new Promise((n,a)=>{try{console.log("paymentMethod",JSON.stringify(t)),n(e.getTransactionInfo(null,null,t.type))}catch(o){exMsg(o),console.error("onPaymentMethodSelected error.",exMsg(o)),a({errors:[o]})}})},validateApplePayMerchant:function(){return new Promise((t,e)=>{try{var n=new XMLHttpRequest;n.open("POST","https://api.cardknox.com/applepay/validate"),n.onload=function(){this.status>=200&&this.status<300?(console.log("validateApplePayMerchant",JSON.stringify(n.response)),t(n.response)):(console.error("validateApplePayMerchant",JSON.stringify(n.response),this.status),e({status:this.status,statusText:n.response}))},n.onerror=function(){console.error("validateApplePayMerchant",n.statusText,this.status),e({status:this.status,statusText:n.statusText})},n.setRequestHeader("Content-Type","application/json"),n.send()}catch(a){setTimeout(function(){console.log("getApplePaySession error: "+exMsg(a))},100)}})},onValidateMerchant:function(){return new Promise((t,e)=>{try{this.validateApplePayMerchant().then(n=>{try{console.log(n),t(n)}catch(a){console.error("validateApplePayMerchant exception.",JSON.stringify(a)),e(a)}}).catch(t=>{console.error("validateApplePayMerchant error.",JSON.stringify(t)),e(t)})}catch(n){console.error("onValidateMerchant error.",JSON.stringify(n)),e(n)}})},authorize:function(t,e){if(console.log(t),t.token.paymentData.data){var n=btoa(JSON.stringify(t.token.paymentData));jQuery("#applePaytoken").val(n),jQuery("#place_order").trigger("click")}},onPaymentAuthorize:function(t){let e=getAmount();return new Promise((n,a)=>{try{this.authorize(t,e.toString()).then(t=>{try{console.log(t);let e=JSON.parse(t);if(!e)throw"Invalid response: "+t;if(e.xError)throw e;n(t)}catch(a){throw a}}).catch(t=>{console.error("authorizeAPay error.",JSON.stringify(t)),apRequest.handleAPError(t),a(t)})}catch(o){console.error("onPaymentAuthorize error.",JSON.stringify(o)),apRequest.handleAPError(o),a(o)}})},handleAPError:function(t){t&&t.xRefNum?setAPPayload("There was a problem with your order:("+t.xRefNum+")"):setAPPayload("There was a problem with your order:"+exMsg(t))},initAP:function(){return{buttonOptions:this.buttonOptions,merchantIdentifier:applePaysettings.merchant_identifier,requiredBillingContactFields:["postalAddress","name","phone","email"],requiredShippingContactFields:["postalAddress","name","phone","email"],onGetTransactionInfo:"apRequest.onGetTransactionInfo",onGetShippingMethods:"apRequest.onGetShippingMethods",onPaymentMethodSelected:"apRequest.onPaymentMethodSelected",onValidateMerchant:"apRequest.onValidateMerchant",onPaymentAuthorize:"apRequest.onPaymentAuthorize",onPaymentComplete:"apRequest.onPaymentComplete",onAPButtonLoaded:"apRequest.apButtonLoaded",isDebug:!0}},isSupportedApplePay:function(){return!!(window.ApplePaySession&&ApplePaySession.canMakePayments())},apButtonLoaded:function(t){t&&(t.status===iStatus.success?showHide(this.buttonOptions.buttonContainer,!0):t.reason&&(jQuery(".applepay-error").html("<div class='woocommerce-error'>"+t.reason+"</div>").show(),console.log(t.reason))),!1==this.isSupportedApplePay()?jQuery(".woocommerce-checkout .payment_method_cardknox-applepay").hide():jQuery(".woocommerce-checkout .payment_method_cardknox-applepay").show()}};