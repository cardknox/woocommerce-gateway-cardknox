jQuery(function(e){e("form.checkout, form#order_review").on("change",'input[name="wc-cardknox-payment-token"]',function(){"new"===e('.cardknox-legacy-payment-fields input[name="wc-cardknox-payment-token"]:checked').val()?e(".cardknox-legacy-payment-fields #cardknox-payment-data").slideDown(200):e(".cardknox-legacy-payment-fields #cardknox-payment-data").slideUp(200)});var o={init:function(){this.onIfieldloaded(),e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_cardknox",this.onSubmit).on("change",this.reset),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form#add_payment_method").on("submit",this.onSubmit),e(document).on("change","#wc-cardknox-cc-form :input",this.reset).on("cardknoxError",this.onError).on("checkout_error",this.reset)},isCardknoxChosen:function(){return e("#payment_method_cardknox").is(":checked")&&(!e('input[name="wc-cardknox-payment-token"]:checked').length||"new"===e('input[name="wc-cardknox-payment-token"]:checked').val())},hasExp:function(){return 0<e("input.xExp").length},block:function(){o.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){o.form.unblock()},onError:function(r,n){console.log("onError"),e(".wc-cardknox-error, .xExp").remove(),e("#ifieldsError").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-cardknox-error"><li>'+n+"</li></ul>"),o.unblock()},onSubmit:function(r){return console.log("onSubmit"),!o.isCardknoxChosen()||!!o.hasExp()||(r.preventDefault(),o.block(),getTokens(function(){return""===document.getElementsByName("xCardNum")[0].value?(e(document).trigger("cardknoxError","Card Number Required"),!1):""===document.getElementsByName("xCVV")[0].value?(e(document).trigger("cardknoxError","CVV Required"),!1):void(console.log("Success"),o.onCardknoxResponse())},function(){return console.log("error"),e(document).trigger("cardknoxError",document.getElementById("ifieldsError").textContent),!1},3e4),!1)},onCardknoxResponse:function(){var r=document.getElementById("cardknox-card-expiry").value.replace(/\s|\//g,"");if(4!=r.length)return e(document).trigger("cardknoxError","Invalid expiration date"),!1;let n=parseInt(r.substr(0,2)),t=parseInt(r.substr(2)),c=new Date,a=c.getFullYear()%100,i=c.getMonth()+1;if(t<a||t===a&&n<i)return $(document).trigger("cardknoxError","Expiration must be in the future"),!1;console.log("onCardknoxResponse"),o.form.append("<input type='hidden' class='xExp' name='xExp' value='"+r+"'/>"),o.form.submit()},reset:function(){e("#cardknox-card-cvc, #cardknox-card-number").val(""),e(".xExp").remove()},onIfieldloaded:function(){enableLogging(),enableAutoFormatting("-"),setAccount(wc_cardknox_params.key,"wordpress","0.1.2"),setIfieldStyle("card-number",{outline:"none",border:"0","border-left-color":"rgb(67, 69, 75)",padding:"0.6180469716em",width:"225px",height:"auto","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit"}),setIfieldStyle("cvv",{outline:"none",border:"0","border-left-color":"rgb(67, 69, 75)",padding:"0.6180469716em",width:"106px",height:"auto","background-color":wc_cardknox_params.bgcolor,"font-weight":"inherit"})}};o.init()}),jQuery(document).ready(function(){jQuery(document.body).on("updated_checkout",function(){jQuery("#ap-container").hide();var e='input[name="payment_method"]',o='button[name="woocommerce_checkout_place_order"]';function r(){"cardknox-applepay"===jQuery(e+":checked").val()?(jQuery(o).hide(),jQuery("#ap-container").show(),jQuery(".applepay-error").show()):(jQuery(o).show(),jQuery("#ap-container").hide(),jQuery(".applepay-error").hide())}r(),jQuery(document).on("change",e,function(){r()})})});